FROM pytorch/pytorch:2.0.0-cuda11.7-cudnn8-runtime

WORKDIR /app

ADD ./src /app/src
ADD ./data /app/data
COPY requirements.txt ./requirements.txt
COPY best_model ./best_model

RUN apt update && apt install -y gcc wget
RUN wget -O best_model "https://cosi217b-transcript-modeling.s3.ca-central-1.amazonaws.com/best_model?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIA3G3FZCGYCC7ZXLGW%2F20230510%2Fca-central-1%2Fs3%2Faws4_request&X-Amz-Date=20230510T193808Z&X-Amz-Expires=604800&X-Amz-SignedHeaders=host&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHwaDGNhLWNlbnRyYWwtMSJGMEQCIH1mzr7PlpzjO4mKEvmoR8zJu8A3dSrJalZX%2FtTzGCSWAiA%2F7KiX2a3Zmnh%2FV1LBQzNAgPI6dcxyUrJIoo9pBpogYCr6AgiV%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDc3MDYyMzIxNDAwMCIMreopWp%2BY36tV3qbhKs4CZKuPvJmMTCmj2Jk71k51bSB0vHfbOe8W3XDboUBBBuKJIQqVF3nIRdhPaOHfL5hJD6zzAXXg35qq5z67V00%2F7qbKIC3IpRcePrhfWp3upPjzDJPkTJPZavcGORYkMgX9%2BSf09zNsLe%2FLhbL6DEeXAuz%2BwYq6aX2jFSWY0rX36f4wT946umZeVxInbpOKLcm7GrKiCHzJHxRcYadiLluEkXmJrSjMQ6g7aDpZ%2BOXaz9B%2FReond7NZhHYQorJsVV0wo%2B92jzi0KLzrsxlmFQOiBo9XTyXAhVqs0Q4B9kQR8SsSJytQsONwK9uu06aAEaReGOZepnI%2Bqn7KMWEx3WFeEFE2YUyrOpBfk6PGFn9R7WEVJiLJ1dngC85cyfmTMocBMnxgP7OPfCUtpLONYirYD52oeca6%2FvW0hFKL%2FH6%2B0BvnUOD%2BtFAKM%2B3uToQCUDD72%2B%2BiBjq0AsxsZs775tlGXJ0Fr%2BZcW8eRcfrzbZ2noU9H9EVGenJc2abfayvAt8FuLRWzSBvWDxrxzzUl2JxA5GD46AvnFzJHhIThu7QOE2mTrJ1JNeLk0wLbB6Sl705UllbPreMIR1u8U3S05LqK6zeyVAV40Fp5gMXCF%2BGyPR2M0FakeoKEFCikyqcBHAsZ%2FW9cwL8N2oaF0ejD1eWMaUD8sRkHb3aPLCBIzgOgXQtcChW3e5xr5bRYNkN%2BPDgvai3S8FV1kF2X2U0P48Ua%2FVc%2FdWCPLrUwPEFZ1QIbySvtiPUaZL%2FfYg9q%2B09N4D0%2BLiVRj5ZlbrYIFtAp6aouw6YOFXqDCg5pmvVxWAU8DXmZCXAYpfJ4KxqsBlyD%2FEobRE8f4zRZ0k4egpYbExa0rZoDDRsgshNAvNT2&X-Amz-Signature=2e9a07ce13977509aa550cf7f9329c15019cca1c6572a0588bf85c2666784e63"
RUN pip install -r requirements.txt

EXPOSE 8501

ENTRYPOINT [ "streamlit", "run" ]

CMD [ "src/home.py" ]
